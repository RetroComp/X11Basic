
<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
   <META NAME="GENERATOR" CONTENT="von Hand">
   <META NAME="Author" CONTENT="M. Hoffmann">
   <META NAME="Description" CONTENT="Beschreibung der Ankopplung von TINEXBASIC ans Kontrollsystem">
   <META NAME="Keywords" CONTENT="X11-Basic, XBASIC, TINEXBASIC, TINE">
   <TITLE>Kopplung XBASIC-Kontrollsystem</TITLE>
</HEAD>
<BODY>

<H1>
Kontrollsystemzugriffe von XBASIC (bzw. TINEXBASIC) aus</H1>

Eigentlich sollte klar sein, wo der Sinn dabei ist, zus&auml;tzlich zu den
Matlab-Programmen noch XBASIC-Programme zu verwenden, n&auml;mlich dort, wo
kleinere Aufgaben erledigt werden m&uumlssen, f&uuml;r die keine extra
MATLAB-Lizenz beschafft werden kann. So lassen sich beliebig viele
XBASIC-Programm auf beliebig vielen Rechnern starten. XBASIC hat die Funktionalit&aumlt eines einfachen BASIC-Interpreters, 
der besonders an die UNIX-Umgebung angepasst ist. 
Zus&auml;tzlich stehen viele Low-Level-Grafikbefehle zur Verf&uuml;gung, die
sogar die Programmierung einer eigenen grafischen Benutzerschnittstelle
erlauben.

<H2>
<IMG SRC="l_blue.gif" > <U>Allgemeine Bemerkungen:</U></H2>

Das Programm mit Kontrollsystemanbindung nennt sich TINEXBASIC. Diese Version
Benutzt die TINE-Bibliothek der DESY-Datenbank. Alle Parameter sind zuganglich (sofern freigeschaltet) und werden
mittels RPC-Protokoll von den ensprechenden Servern erfragt. Bisher ist aus sicherheitsgruenden 
nur der lesende Zugriff implementiert.
<H2>
<IMG SRC="l_blue.gif" > <U>Parameternamen:</U></H2>
Die Zugriffe zu den Parametern erfolgen ueber einen eindeutigen Namen, der aus Servername, Devicename und 
Propertyname besteht. Die Syntax ist wie folgt:
<pre>

SERVER/DEVICE[Property]
 
</pre>


<H2>

<HR WIDTH="100%"></H2>

<H2>
<IMG SRC="l_blue.gif" > <U>Befehle:</U></H2>


<H3>
<IMG SRC="red.gif" > Einzelnen Wert abfragen</H3>
<TT>a=tineget("&lt;Parameter>")<br>
    a$=tineget$("&lt;Parameter>") </TT>

<P>R&uuml;ckgabewert ist der Wert des entsprechenden Parameters. Falls
ein Fehler aufgetreten ist, wird Null zur&uuml;ckgegeben, bzw. bei Zeichenketten die Zeichenkette
"&lt;ERROR>".
<H3>
<IMG SRC="red.gif" > Vektorparameter abfragen</H3>
<TT>a()=tinevget("&lt;Parameter>" [, &lt;Anzahl der Werte>[,&lt;Offset>]])<br>
    b$()=tinevget$("&lt;Parameter>" [, &lt;Anzahl der Werte>[,&lt;Offset>]])
</TT>

<P>

Die angebene Anzahl an Werten wird als Vektor zur&uuml;ckgegeben. Falls ein
Offset angegeben wird, wird ab dem entsprechenden Eintrag des Vektors gelesen.
Das Ergebnis wird einem Feld zugewiesen, welches ggf. umdimensioniert wird. 
Wird die Anzahl der Werte nicht angegeben, so wird der gesamte Vektor gelesen.
Der erste Eintrag des ccs-Vektors findet sich dann in a(0). Der letzte in
a(n-1).

<!--
<H3>
<IMG SRC="red.gif" > Parameter setzen</H3>
<TT>csput Parameter$, Wert <br>csput Parameter$, Wert$
</TT>



<P>Der angebene Parameter wird auf die angebenen Werte gesetzt. 
<H3>
<IMG SRC="red.gif" > Parameter-Vektor setzen</H3>
<TT>csvput Parameter$, Werte()[,n[,o]] <br>csvput Parameter$, Werte$()[,n[,o]]
</TT>

<P>Der angebene Parameter wird auf die angebenen Werte gesetzt. n=Anzahl der zu setzenden Werte,
 o=Offset.


<H3>
<IMG SRC="red.gif" > Auf die &Auml;nderung eines Parameter-wertes warten</H3>
<TT>cswait "&lt;Parameter>" [, &lt;Time-out>]</TT>

<P>

Es wird gewartet, bis sich der angegebene Parameter ge&auml;ndert hat, maximal
aber die im Time-out angebene Zeit (in Sekunden, bei Angabe von 0 wird
unbegrenzt gewartet). Hat sich der Parameter in dieser Zeit nicht
ge&auml;ndert, wird dies als Fehlerbedingung aufgefa&szlig;t (CCSERR = -1).

--!>
<H3>
<IMG SRC="red.gif" > Minimum und Maximum eines Parameters abfragen</H3>
<pre>
    a=tinemin("&lt;Parameter>")
    b=tinemax("&lt;Parameter>")
</pre>

<P> Falls ein Fehler
auftritt, wird Null zur&uuml;ckgegeben.

<H3>
<IMG SRC="red.gif" > Maximalzahl der Werte (Vektorlaenge) eines Parameters zur&uuml;ckgeben</H3>
<TT>s=tinesize("&lt;Parameter>")</TT>

<P>Es wird die Anzahl der Werte zur&uuml;ckgegeben, die f&uuml;r diesen
Parameter definiert ist, zur&uuml;ckgegeben. Falls ein Fehler auftritt,
wird Null zur&uuml;ckgegeben.

<H3>
<IMG SRC="red.gif" > Callback-Proceduren definieren  </h3>
<pre>
cssetcallback Parameter$,Procedure
csclearcallbacks
</pre>
<p>

Es wird eine Procedure angegeben, die bei Aenderung des Parameters Parameter$
automatisch aufgerufen wird. Mit csclearcallbacks werden alle Funktionen
deaktiviert.


<p>
<em>Beispiel:</em><br>
<pre>
cssetcallback "POL_LASER_EXPERT.INTENSITY_AM", nachregeln
'... weiterer Programmcode
end
procedure nachregeln
  print "Intensitaet hat nachgelassen."
  '... jetzt muss was getan werden...
return

</pre>
 
<P>
<HR WIDTH="100%">
<ADDRESS>
<A HREF="mailto:markus.hoffmann@desy_NOSPAM.de">M. Hoffmann</A></ADDRESS>

<ADDRESS>
9. Sept. 2002</ADDRESS>

</BODY>
</HTML>
